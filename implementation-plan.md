# åŠ¨æ¼«è§‚çœ‹è¿›åº¦å¾®ä¿¡å°ç¨‹åº - é¡¹ç›®å®æ–½æ–¹æ¡ˆ

> é¡¹ç›®åç§°ï¼šMy Bangumiï¼ˆæˆ‘çš„ç•ªç»„è®¡åˆ’ï¼‰
>
> ç‰ˆæœ¬ï¼šv1.0
>
> æ›´æ–°æ—¥æœŸï¼š2025å¹´11æœˆ17æ—¥

---

## ä¸€ã€é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®ç›®æ ‡

å¼€å‘ä¸€æ¬¾åŠ¨æ¼«è§‚çœ‹è¿›åº¦ç®¡ç†å¾®ä¿¡å°ç¨‹åºï¼Œå¸®åŠ©ç”¨æˆ·è®°å½•å’Œç®¡ç†åŠ¨æ¼«è§‚çœ‹è¿›åº¦ï¼Œå‘ç°å’Œæ”¶è—æ„Ÿå…´è¶£çš„åŠ¨æ¼«ä½œå“ã€‚

### 1.2 æ ¸å¿ƒç‰¹æ€§

- ä¸­æ–‡/æ—¥æ–‡åŠ¨æ¼«æœç´¢
- è§‚çœ‹è¿›åº¦è®°å½•ï¼ˆå­£/é›†ï¼‰
- æƒ³çœ‹/åœ¨çœ‹/çœ‹è¿‡çŠ¶æ€ç®¡ç†
- ä½œå“ç‚¹èµï¼ˆå–œæ¬¢ï¼‰åŠŸèƒ½
- å¾®ä¿¡ç™»å½• + æ‰‹æœºå·ç»‘å®š
- ç”¨æˆ·ä¸ªæ€§åŒ–è®¾ç½®ï¼ˆå¤´åƒã€6ä½UIDï¼‰
- è±†ç“£é£æ ¼ç•Œé¢

### 1.3 ç›®æ ‡ç”¨æˆ·

- åŠ¨æ¼«çˆ±å¥½è€…
- éœ€è¦ç®¡ç†è§‚çœ‹è¿›åº¦çš„ç”¨æˆ·
- å–œæ¬¢è®°å½•å’Œåˆ†äº«çš„ç”¨æˆ·

---

## äºŒã€æŠ€æœ¯æ ˆæ¸…å•

### 2.1 å‰ç«¯æŠ€æœ¯æ ˆ

```yaml
æ¡†æ¶: Taro 3.6+
è¯­è¨€: TypeScript 5.0+
UIåº“: Taro UI 3.1+
çŠ¶æ€ç®¡ç†: React Hooks + Context API
æ ·å¼: SCSS
æ‰“åŒ…å·¥å…·: Webpack 5
```

### 2.2 åç«¯æŠ€æœ¯æ ˆ

```yaml
æ¶æ„: å¾®ä¿¡äº‘å¼€å‘ (Serverless)
äº‘å‡½æ•°: Node.js 16
æ•°æ®åº“: äº‘æ•°æ®åº“ (MongoDB)
å­˜å‚¨: äº‘å­˜å‚¨
è®¤è¯: å¾®ä¿¡ç™»å½•
```

### 2.3 ç¬¬ä¸‰æ–¹æœåŠ¡

```yaml
åŠ¨æ¼«æ•°æ®: Bangumi API (https://bangumi.github.io/api/)
å¯é€‰çŸ­ä¿¡: è…¾è®¯äº‘çŸ­ä¿¡æœåŠ¡ (æ‰‹æœºå·éªŒè¯ç )
```

### 2.4 å¼€å‘å·¥å…·

```yaml
IDE: VS Code
å°ç¨‹åºå¼€å‘å·¥å…·: å¾®ä¿¡å¼€å‘è€…å·¥å…·
ç‰ˆæœ¬æ§åˆ¶: Git
åŒ…ç®¡ç†: npm / yarn / pnpm
```

---

## ä¸‰ã€é¡¹ç›®æ¶æ„è®¾è®¡

### 3.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å¾®ä¿¡å°ç¨‹åºç«¯                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ é¦–é¡µæœç´¢  â”‚  â”‚ æˆ‘çš„æ”¶è— â”‚  â”‚ ä¸ªäººä¸­å¿ƒ  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                   â†“ Taro                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“ HTTP / WebSocket
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  å¾®ä¿¡äº‘å¼€å‘                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  äº‘å‡½æ•°   â”‚  â”‚  äº‘æ•°æ®åº“ â”‚  â”‚  äº‘å­˜å‚¨   â”‚      â”‚
â”‚  â”‚ (Node.js) â”‚  â”‚ (MongoDB) â”‚  â”‚ (å¤´åƒ)   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“ HTTP
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Bangumi API                        â”‚
â”‚            (åŠ¨æ¼«å…ƒæ•°æ®æœåŠ¡)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 å‰ç«¯é¡¹ç›®ç»“æ„

```
my-bangumi/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ pages/                    # é¡µé¢
â”‚   â”‚   â”œâ”€â”€ index/               # é¦–é¡µï¼ˆæœç´¢+æ¨èï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ index.tsx
â”‚   â”‚   â”‚   â””â”€â”€ index.scss
â”‚   â”‚   â”œâ”€â”€ search/              # æœç´¢ç»“æœé¡µ
â”‚   â”‚   â”œâ”€â”€ anime-detail/        # åŠ¨æ¼«è¯¦æƒ…é¡µ
â”‚   â”‚   â”œâ”€â”€ my-collection/       # æˆ‘çš„æ”¶è—
â”‚   â”‚   â”‚   â”œâ”€â”€ watching.tsx     # åœ¨çœ‹
â”‚   â”‚   â”‚   â”œâ”€â”€ watched.tsx      # çœ‹è¿‡
â”‚   â”‚   â”‚   â””â”€â”€ wishlist.tsx     # æƒ³çœ‹
â”‚   â”‚   â”œâ”€â”€ profile/             # ä¸ªäººä¸­å¿ƒ
â”‚   â”‚   â””â”€â”€ login/               # ç™»å½•é¡µ
â”‚   â”œâ”€â”€ components/               # å…¬å…±ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ AnimeCard/           # åŠ¨æ¼«å¡ç‰‡ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ EpisodeSelector/     # é›†æ•°é€‰æ‹©å™¨
â”‚   â”‚   â”œâ”€â”€ SeasonSelector/      # å­£æ•°é€‰æ‹©å™¨
â”‚   â”‚   â””â”€â”€ RatingStars/         # è¯„åˆ†æ˜Ÿæ˜Ÿ
â”‚   â”œâ”€â”€ services/                 # æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ anime.ts             # åŠ¨æ¼«ç›¸å…³API
â”‚   â”‚   â”œâ”€â”€ user.ts              # ç”¨æˆ·ç›¸å…³API
â”‚   â”‚   â””â”€â”€ collection.ts        # æ”¶è—ç›¸å…³API
â”‚   â”œâ”€â”€ utils/                    # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ request.ts           # ç½‘ç»œè¯·æ±‚å°è£…
â”‚   â”‚   â”œâ”€â”€ storage.ts           # æœ¬åœ°å­˜å‚¨
â”‚   â”‚   â””â”€â”€ date.ts              # æ—¥æœŸå¤„ç†
â”‚   â”œâ”€â”€ constants/                # å¸¸é‡å®šä¹‰
â”‚   â”‚   â””â”€â”€ status.ts            # è§‚çœ‹çŠ¶æ€å¸¸é‡
â”‚   â”œâ”€â”€ types/                    # TypeScriptç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ anime.d.ts
â”‚   â”‚   â”œâ”€â”€ user.d.ts
â”‚   â”‚   â””â”€â”€ collection.d.ts
â”‚   â”œâ”€â”€ app.config.ts             # åº”ç”¨é…ç½®
â”‚   â”œâ”€â”€ app.tsx                   # åº”ç”¨å…¥å£
â”‚   â””â”€â”€ app.scss                  # å…¨å±€æ ·å¼
â”œâ”€â”€ cloud/                        # äº‘å‡½æ•°
â”‚   â”œâ”€â”€ functions/
â”‚   â”‚   â”œâ”€â”€ login/               # ç™»å½•
â”‚   â”‚   â”œâ”€â”€ searchAnime/         # æœç´¢åŠ¨æ¼«
â”‚   â”‚   â”œâ”€â”€ getAnimeDetail/      # è·å–åŠ¨æ¼«è¯¦æƒ…
â”‚   â”‚   â”œâ”€â”€ updateWatchProgress/ # æ›´æ–°è§‚çœ‹è¿›åº¦
â”‚   â”‚   â”œâ”€â”€ addCollection/       # æ·»åŠ æ”¶è—
â”‚   â”‚   â”œâ”€â”€ removeCollection/    # ç§»é™¤æ”¶è—
â”‚   â”‚   â”œâ”€â”€ toggleLike/          # åˆ‡æ¢å–œæ¬¢çŠ¶æ€
â”‚   â”‚   â””â”€â”€ getUserProfile/      # è·å–ç”¨æˆ·ä¿¡æ¯
â”‚   â””â”€â”€ database/                 # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”‚       â””â”€â”€ init.json
â”œâ”€â”€ project.config.json           # å°ç¨‹åºé…ç½®
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

### 3.3 äº‘å‡½æ•°è®¾è®¡

#### äº‘å‡½æ•°åˆ—è¡¨

| å‡½æ•°å | åŠŸèƒ½ | è§¦å‘æ–¹å¼ |
|--------|------|---------|
| `login` | ç”¨æˆ·ç™»å½•/æ³¨å†Œ | å°ç¨‹åºè°ƒç”¨ |
| `updateUserProfile` | æ›´æ–°ç”¨æˆ·ä¿¡æ¯ | å°ç¨‹åºè°ƒç”¨ |
| `bindPhone` | ç»‘å®šæ‰‹æœºå· | å°ç¨‹åºè°ƒç”¨ |
| `searchAnime` | æœç´¢åŠ¨æ¼« | å°ç¨‹åºè°ƒç”¨ |
| `getAnimeDetail` | è·å–åŠ¨æ¼«è¯¦æƒ… | å°ç¨‹åºè°ƒç”¨ |
| `syncAnimeData` | åŒæ­¥åŠ¨æ¼«æ•°æ®ï¼ˆå®šæ—¶ï¼‰ | å®šæ—¶è§¦å‘ |
| `addCollection` | æ·»åŠ æ”¶è— | å°ç¨‹åºè°ƒç”¨ |
| `removeCollection` | ç§»é™¤æ”¶è— | å°ç¨‹åºè°ƒç”¨ |
| `updateCollectionStatus` | æ›´æ–°æ”¶è—çŠ¶æ€ | å°ç¨‹åºè°ƒç”¨ |
| `updateWatchProgress` | æ›´æ–°è§‚çœ‹è¿›åº¦ | å°ç¨‹åºè°ƒç”¨ |
| `toggleLike` | åˆ‡æ¢å–œæ¬¢çŠ¶æ€ | å°ç¨‹åºè°ƒç”¨ |
| `getMyCollections` | è·å–æˆ‘çš„æ”¶è—åˆ—è¡¨ | å°ç¨‹åºè°ƒç”¨ |
| `getUserStats` | è·å–ç”¨æˆ·ç»Ÿè®¡ | å°ç¨‹åºè°ƒç”¨ |

### 3.4 æ•°æ®åº“è®¾è®¡

#### 3.4.1 ç”¨æˆ·è¡¨ `users`

```javascript
{
  _id: "auto_generated",           // ç³»ç»Ÿç”Ÿæˆçš„å”¯ä¸€ID
  _openid: "user_openid",          // å¾®ä¿¡OpenIDï¼ˆäº‘å¼€å‘è‡ªåŠ¨ç”Ÿæˆï¼‰
  uid: "123456",                   // 6ä½æ•°å­—UID
  nickname: "åŠ¨æ¼«çˆ±å¥½è€…",            // æ˜µç§°
  avatar: "cloud://...",           // å¤´åƒäº‘å­˜å‚¨è·¯å¾„
  phone: "13800138000",            // æ‰‹æœºå·ï¼ˆå¯é€‰ï¼‰
  phoneVerified: false,            // æ‰‹æœºå·æ˜¯å¦éªŒè¯
  createTime: 1700000000000,       // æ³¨å†Œæ—¶é—´ï¼ˆæ—¶é—´æˆ³ï¼‰
  lastLoginTime: 1700000000000,    // æœ€åç™»å½•æ—¶é—´
  stats: {                         // ç”¨æˆ·ç»Ÿè®¡
    totalAnime: 50,                // æ”¶è—æ€»æ•°
    watching: 5,                   // åœ¨çœ‹æ•°é‡
    watched: 40,                   // çœ‹è¿‡æ•°é‡
    wishlist: 5,                   // æƒ³çœ‹æ•°é‡
    totalLikes: 20                 // ç‚¹èµæ€»æ•°
  }
}
```

**ç´¢å¼•ï¼š**
- `_openid` (å”¯ä¸€)
- `uid` (å”¯ä¸€)
- `phone` (å”¯ä¸€, ç¨€ç–ç´¢å¼•)

#### 3.4.2 åŠ¨æ¼«ç¼“å­˜è¡¨ `anime_cache`

ç”¨äºç¼“å­˜Bangumi APIçš„åŠ¨æ¼«æ•°æ®ï¼Œå‡å°‘APIè°ƒç”¨

```javascript
{
  _id: "auto_generated",
  bangumiId: 55770,                // BangumiåŠ¨æ¼«ID
  name: "é€²æ’ƒã®å·¨äºº",               // æ—¥æ–‡å
  nameCn: "è¿›å‡»çš„å·¨äºº",             // ä¸­æ–‡å
  summary: "ä½œå“ç®€ä»‹...",           // ç®€ä»‹
  type: 2,                         // ç±»å‹ï¼š2=åŠ¨ç”»
  eps: 25,                         // æ€»é›†æ•°
  airDate: "2013-04-07",           // å¼€æ’­æ—¥æœŸ
  images: {                        // å›¾ç‰‡
    large: "https://...",
    common: "https://...",
    medium: "https://...",
    small: "https://...",
    grid: "https://..."
  },
  rating: {                        // è¯„åˆ†
    total: 12345,                  // è¯„åˆ†äººæ•°
    score: 8.5                     // è¯„åˆ†
  },
  tags: ["åŠ¨ä½œ", "ç§‘å¹»"],           // æ ‡ç­¾
  seasons: [                       // å­£ä¿¡æ¯ï¼ˆæ‰‹åŠ¨ç»´æŠ¤æˆ–ä»APIè·å–ï¼‰
    {
      season: 1,
      name: "è¿›å‡»çš„å·¨äºº ç¬¬ä¸€å­£",
      bangumiId: 55770,
      episodes: 25
    },
    {
      season: 2,
      name: "è¿›å‡»çš„å·¨äºº ç¬¬äºŒå­£",
      bangumiId: 183088,
      episodes: 12
    }
  ],
  updateTime: 1700000000000,       // ç¼“å­˜æ›´æ–°æ—¶é—´
  expireTime: 1700086400000        // ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼ˆ24å°æ—¶åï¼‰
}
```

**ç´¢å¼•ï¼š**
- `bangumiId` (å”¯ä¸€)
- `nameCn` (æ–‡æœ¬ç´¢å¼•)
- `name` (æ–‡æœ¬ç´¢å¼•)
- `expireTime` (TTLç´¢å¼•ï¼Œè‡ªåŠ¨åˆ é™¤è¿‡æœŸæ•°æ®)

#### 3.4.3 æ”¶è—è¡¨ `collections`

```javascript
{
  _id: "auto_generated",
  userId: "user_openid",           // ç”¨æˆ·OpenID
  uid: "123456",                   // ç”¨æˆ·UIDï¼ˆå†—ä½™ï¼Œä¾¿äºæŸ¥è¯¢ï¼‰
  animeId: 55770,                  // BangumiåŠ¨æ¼«ID
  animeName: "è¿›å‡»çš„å·¨äºº",          // åŠ¨æ¼«åç§°ï¼ˆå†—ä½™ï¼‰
  animeCover: "https://...",       // å°é¢å›¾ï¼ˆå†—ä½™ï¼‰
  status: "watching",              // çŠ¶æ€ï¼šwishlist/watching/watched
  isLiked: true,                   // æ˜¯å¦ç‚¹èµ/å–œæ¬¢
  currentSeason: 1,                // å½“å‰è§‚çœ‹çš„å­£ï¼ˆwatchingæ—¶æœ‰æ•ˆï¼‰
  currentEpisode: 15,              // å½“å‰è§‚çœ‹åˆ°ç¬¬å‡ é›†ï¼ˆwatchingæ—¶æœ‰æ•ˆï¼‰
  totalSeasons: 4,                 // æ€»å­£æ•°
  startDate: 1700000000000,        // å¼€å§‹çœ‹çš„æ—¶é—´
  finishDate: null,                // çœ‹å®Œçš„æ—¶é—´ï¼ˆwatchedæ—¶æœ‰å€¼ï¼‰
  updateTime: 1700000000000,       // æœ€åæ›´æ–°æ—¶é—´
  createTime: 1700000000000,       // æ·»åŠ åˆ°æ”¶è—çš„æ—¶é—´
  note: "è¶…çº§å¥½çœ‹ï¼",               // å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰
  myRating: 9                      // ä¸ªäººè¯„åˆ† 1-10ï¼ˆå¯é€‰ï¼‰
}
```

**ç´¢å¼•ï¼š**
- `userId` + `animeId` (è”åˆå”¯ä¸€ç´¢å¼•)
- `userId` + `status` (è”åˆç´¢å¼•)
- `userId` + `isLiked` (è”åˆç´¢å¼•)
- `updateTime` (é™åº)

#### 3.4.4 è§‚çœ‹å†å²è¡¨ `watch_history`

å¯é€‰è¡¨ï¼Œç”¨äºè®°å½•æ›´è¯¦ç»†çš„è§‚çœ‹å†å²

```javascript
{
  _id: "auto_generated",
  userId: "user_openid",
  animeId: 55770,
  season: 1,
  episode: 15,
  watchTime: 1700000000000,        // è§‚çœ‹æ—¶é—´
  duration: 1440000                // è§‚çœ‹æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰ï¼Œå¯é€‰
}
```

**ç´¢å¼•ï¼š**
- `userId` + `animeId` (è”åˆç´¢å¼•)
- `watchTime` (é™åº)

#### 3.4.5 UIDè®¡æ•°å™¨è¡¨ `counters`

ç”¨äºç”Ÿæˆé€’å¢çš„6ä½UID

```javascript
{
  _id: "user_uid",                 // å›ºå®šID
  seq: 100000                      // å½“å‰åºåˆ—å·ï¼ˆä»100000å¼€å§‹ï¼‰
}
```

---

## å››ã€æ ¸å¿ƒåŠŸèƒ½å®ç°æ–¹æ¡ˆ

### 4.1 åŠ¨æ¼«æœç´¢åŠŸèƒ½

#### 4.1.1 æœç´¢æµç¨‹

```
ç”¨æˆ·è¾“å…¥å…³é”®è¯
    â†“
å‰ç«¯è°ƒç”¨äº‘å‡½æ•° searchAnime
    â†“
äº‘å‡½æ•°å…ˆæŸ¥è¯¢æœ¬åœ°ç¼“å­˜ï¼ˆanime_cacheï¼‰
    â†“
å¦‚æœç¼“å­˜å‘½ä¸­ä¸”æœªè¿‡æœŸ â†’ è¿”å›ç¼“å­˜ç»“æœ
    â†“
å¦‚æœç¼“å­˜æœªå‘½ä¸­ â†’ è°ƒç”¨ Bangumi API
    â†“
å­˜å‚¨åˆ° anime_cacheï¼ˆè®¾ç½®24å°æ—¶è¿‡æœŸï¼‰
    â†“
è¿”å›ç»“æœç»™å‰ç«¯
```

#### 4.1.2 äº‘å‡½æ•°å®ç°ç¤ºä¾‹

```javascript
// cloud/functions/searchAnime/index.js
const cloud = require('wx-server-sdk')
const axios = require('axios')

cloud.init()
const db = cloud.database()

exports.main = async (event, context) => {
  const { keyword, type = 2 } = event  // type=2è¡¨ç¤ºåŠ¨ç”»

  try {
    // 1. å…ˆæŸ¥è¯¢æœ¬åœ°ç¼“å­˜
    const cacheResult = await db.collection('anime_cache')
      .where({
        $or: [
          { nameCn: db.RegExp({ regexp: keyword, options: 'i' }) },
          { name: db.RegExp({ regexp: keyword, options: 'i' }) }
        ],
        expireTime: db.command.gt(Date.now())
      })
      .limit(20)
      .get()

    if (cacheResult.data.length > 0) {
      return { success: true, data: cacheResult.data, from: 'cache' }
    }

    // 2. ç¼“å­˜æœªå‘½ä¸­ï¼Œè°ƒç”¨Bangumi API
    const response = await axios.get(
      `https://api.bgm.tv/search/subject/${encodeURIComponent(keyword)}`,
      { params: { type } }
    )

    const animeList = response.data.list || []

    // 3. å­˜å‚¨åˆ°ç¼“å­˜ï¼ˆæ‰¹é‡å†™å…¥ï¼‰
    const now = Date.now()
    const expireTime = now + 24 * 60 * 60 * 1000  // 24å°æ—¶åè¿‡æœŸ

    for (const anime of animeList.slice(0, 20)) {  // åªç¼“å­˜å‰20æ¡
      await db.collection('anime_cache').add({
        data: {
          bangumiId: anime.id,
          name: anime.name,
          nameCn: anime.name_cn,
          summary: anime.summary,
          type: anime.type,
          eps: anime.eps,
          airDate: anime.air_date,
          images: anime.images,
          rating: anime.rating,
          updateTime: now,
          expireTime: expireTime
        }
      }).catch(err => {
        // å¿½ç•¥é‡å¤æ’å…¥é”™è¯¯
        if (err.errCode !== -502002) throw err
      })
    }

    return { success: true, data: animeList, from: 'api' }

  } catch (error) {
    console.error('Search error:', error)
    return { success: false, error: error.message }
  }
}
```

#### 4.1.3 å‰ç«¯è°ƒç”¨

```typescript
// src/services/anime.ts
import Taro from '@tarojs/taro'

export interface AnimeSearchResult {
  id: number
  name: string
  name_cn: string
  summary: string
  images: {
    large: string
    common: string
    medium: string
  }
  rating: {
    total: number
    score: number
  }
  eps: number
}

export const searchAnime = async (keyword: string): Promise<AnimeSearchResult[]> => {
  Taro.showLoading({ title: 'æœç´¢ä¸­...' })

  try {
    const res = await Taro.cloud.callFunction({
      name: 'searchAnime',
      data: { keyword }
    })

    Taro.hideLoading()

    if (res.result.success) {
      return res.result.data
    } else {
      Taro.showToast({ title: 'æœç´¢å¤±è´¥', icon: 'none' })
      return []
    }
  } catch (error) {
    Taro.hideLoading()
    Taro.showToast({ title: 'ç½‘ç»œé”™è¯¯', icon: 'none' })
    return []
  }
}
```

### 4.2 ç”¨æˆ·ç™»å½•ä¸æ³¨å†Œ

#### 4.2.1 ç™»å½•æµç¨‹

```
å°ç¨‹åºå¯åŠ¨
    â†“
è°ƒç”¨ wx.cloud.callFunction('login')
    â†“
äº‘å‡½æ•°è·å– openidï¼ˆè‡ªåŠ¨ï¼‰
    â†“
æŸ¥è¯¢ users è¡¨æ˜¯å¦å­˜åœ¨è¯¥ç”¨æˆ·
    â†“
å¦‚æœå­˜åœ¨ â†’ æ›´æ–°lastLoginTimeï¼Œè¿”å›ç”¨æˆ·ä¿¡æ¯
    â†“
å¦‚æœä¸å­˜åœ¨ â†’ åˆ›å»ºæ–°ç”¨æˆ·ï¼ˆç”ŸæˆUIDï¼‰ï¼Œè¿”å›ç”¨æˆ·ä¿¡æ¯
    â†“
å‰ç«¯å­˜å‚¨ç”¨æˆ·ä¿¡æ¯åˆ°æœ¬åœ°
```

#### 4.2.2 äº‘å‡½æ•°å®ç°

```javascript
// cloud/functions/login/index.js
const cloud = require('wx-server-sdk')

cloud.init()
const db = cloud.database()
const _ = db.command

// ç”Ÿæˆ6ä½UID
async function generateUID() {
  const counterRes = await db.collection('counters')
    .doc('user_uid')
    .update({
      data: {
        seq: _.inc(1)
      }
    })

  // å¦‚æœè®¡æ•°å™¨ä¸å­˜åœ¨ï¼Œå…ˆåˆ›å»º
  if (counterRes.stats.updated === 0) {
    await db.collection('counters').add({
      data: {
        _id: 'user_uid',
        seq: 100000
      }
    })
    return '100000'
  }

  // è·å–æœ€æ–°çš„åºåˆ—å·
  const counter = await db.collection('counters').doc('user_uid').get()
  return counter.data.seq.toString()
}

exports.main = async (event, context) => {
  const wxContext = cloud.getWXContext()
  const openid = wxContext.OPENID

  try {
    // æŸ¥è¯¢ç”¨æˆ·æ˜¯å¦å­˜åœ¨
    const userRes = await db.collection('users')
      .where({ _openid: openid })
      .get()

    const now = Date.now()

    if (userRes.data.length > 0) {
      // ç”¨æˆ·å·²å­˜åœ¨ï¼Œæ›´æ–°æœ€åç™»å½•æ—¶é—´
      const user = userRes.data[0]
      await db.collection('users').doc(user._id).update({
        data: { lastLoginTime: now }
      })

      return { success: true, isNewUser: false, user }
    } else {
      // æ–°ç”¨æˆ·ï¼Œåˆ›å»ºè´¦å·
      const uid = await generateUID()

      const newUser = {
        _openid: openid,
        uid: uid,
        nickname: 'ç”¨æˆ·' + uid,
        avatar: 'cloud://default-avatar.png',  // é»˜è®¤å¤´åƒ
        phone: null,
        phoneVerified: false,
        createTime: now,
        lastLoginTime: now,
        stats: {
          totalAnime: 0,
          watching: 0,
          watched: 0,
          wishlist: 0,
          totalLikes: 0
        }
      }

      const addRes = await db.collection('users').add({
        data: newUser
      })

      newUser._id = addRes._id

      return { success: true, isNewUser: true, user: newUser }
    }
  } catch (error) {
    console.error('Login error:', error)
    return { success: false, error: error.message }
  }
}
```

#### 4.2.3 å‰ç«¯è°ƒç”¨

```typescript
// src/services/user.ts
import Taro from '@tarojs/taro'

export interface User {
  _id: string
  uid: string
  nickname: string
  avatar: string
  phone?: string
  stats: {
    totalAnime: number
    watching: number
    watched: number
    wishlist: number
    totalLikes: number
  }
}

export const login = async (): Promise<User | null> => {
  try {
    const res = await Taro.cloud.callFunction({
      name: 'login',
      data: {}
    })

    if (res.result.success) {
      const user = res.result.user
      // å­˜å‚¨åˆ°æœ¬åœ°
      Taro.setStorageSync('user', user)
      return user
    }
    return null
  } catch (error) {
    console.error('Login error:', error)
    return null
  }
}

export const getUserInfo = (): User | null => {
  return Taro.getStorageSync('user') || null
}
```

### 4.3 è§‚çœ‹è¿›åº¦è®°å½•

#### 4.3.1 æ›´æ–°è¿›åº¦äº‘å‡½æ•°

```javascript
// cloud/functions/updateWatchProgress/index.js
const cloud = require('wx-server-sdk')

cloud.init()
const db = cloud.database()

exports.main = async (event, context) => {
  const wxContext = cloud.getWXContext()
  const openid = wxContext.OPENID

  const { animeId, season, episode } = event

  try {
    const now = Date.now()

    // æ›´æ–°æ”¶è—è¡¨ä¸­çš„è¿›åº¦
    const updateRes = await db.collection('collections')
      .where({
        userId: openid,
        animeId: animeId
      })
      .update({
        data: {
          currentSeason: season,
          currentEpisode: episode,
          status: 'watching',  // è‡ªåŠ¨è®¾ä¸º"åœ¨çœ‹"
          updateTime: now
        }
      })

    // å¦‚æœæ”¶è—ä¸å­˜åœ¨ï¼Œéœ€è¦å…ˆæ·»åŠ æ”¶è—
    if (updateRes.stats.updated === 0) {
      return {
        success: false,
        error: 'Please add to collection first'
      }
    }

    // å¯é€‰ï¼šè®°å½•åˆ°è§‚çœ‹å†å²è¡¨
    await db.collection('watch_history').add({
      data: {
        userId: openid,
        animeId: animeId,
        season: season,
        episode: episode,
        watchTime: now
      }
    })

    return { success: true }

  } catch (error) {
    console.error('Update progress error:', error)
    return { success: false, error: error.message }
  }
}
```

### 4.4 æ”¶è—ç³»ç»Ÿï¼ˆæƒ³çœ‹/åœ¨çœ‹/çœ‹è¿‡ï¼‰

#### 4.4.1 æ·»åŠ æ”¶è—äº‘å‡½æ•°

```javascript
// cloud/functions/addCollection/index.js
const cloud = require('wx-server-sdk')

cloud.init()
const db = cloud.database()
const _ = db.command

exports.main = async (event, context) => {
  const wxContext = cloud.getWXContext()
  const openid = wxContext.OPENID

  const {
    animeId,
    animeName,
    animeCover,
    status,        // wishlist/watching/watched
    totalSeasons = 1
  } = event

  try {
    // è·å–ç”¨æˆ·UID
    const userRes = await db.collection('users')
      .where({ _openid: openid })
      .get()

    if (userRes.data.length === 0) {
      return { success: false, error: 'User not found' }
    }

    const user = userRes.data[0]
    const now = Date.now()

    // æ£€æŸ¥æ˜¯å¦å·²æ”¶è—
    const existRes = await db.collection('collections')
      .where({
        userId: openid,
        animeId: animeId
      })
      .get()

    if (existRes.data.length > 0) {
      // å·²å­˜åœ¨ï¼Œæ›´æ–°çŠ¶æ€
      await db.collection('collections')
        .doc(existRes.data[0]._id)
        .update({
          data: {
            status: status,
            updateTime: now
          }
        })
    } else {
      // æ–°å¢æ”¶è—
      await db.collection('collections').add({
        data: {
          userId: openid,
          uid: user.uid,
          animeId: animeId,
          animeName: animeName,
          animeCover: animeCover,
          status: status,
          isLiked: false,
          currentSeason: status === 'watching' ? 1 : 0,
          currentEpisode: status === 'watching' ? 1 : 0,
          totalSeasons: totalSeasons,
          startDate: status === 'watching' ? now : null,
          finishDate: status === 'watched' ? now : null,
          updateTime: now,
          createTime: now,
          note: '',
          myRating: null
        }
      })

      // æ›´æ–°ç”¨æˆ·ç»Ÿè®¡
      const statsUpdate = {}
      statsUpdate[`stats.${status}`] = _.inc(1)
      statsUpdate['stats.totalAnime'] = _.inc(1)

      await db.collection('users')
        .doc(user._id)
        .update({ data: statsUpdate })
    }

    return { success: true }

  } catch (error) {
    console.error('Add collection error:', error)
    return { success: false, error: error.message }
  }
}
```

### 4.5 å–œæ¬¢åŠŸèƒ½

#### 4.5.1 åˆ‡æ¢å–œæ¬¢çŠ¶æ€äº‘å‡½æ•°

```javascript
// cloud/functions/toggleLike/index.js
const cloud = require('wx-server-sdk')

cloud.init()
const db = cloud.database()
const _ = db.command

exports.main = async (event, context) => {
  const wxContext = cloud.getWXContext()
  const openid = wxContext.OPENID

  const { animeId } = event

  try {
    // æŸ¥è¯¢æ”¶è—è®°å½•
    const collectionRes = await db.collection('collections')
      .where({
        userId: openid,
        animeId: animeId
      })
      .get()

    if (collectionRes.data.length === 0) {
      return { success: false, error: 'Not in collection' }
    }

    const collection = collectionRes.data[0]
    const newLikeStatus = !collection.isLiked

    // æ›´æ–°å–œæ¬¢çŠ¶æ€
    await db.collection('collections')
      .doc(collection._id)
      .update({
        data: {
          isLiked: newLikeStatus,
          updateTime: Date.now()
        }
      })

    // æ›´æ–°ç”¨æˆ·ç»Ÿè®¡
    const userRes = await db.collection('users')
      .where({ _openid: openid })
      .get()

    if (userRes.data.length > 0) {
      await db.collection('users')
        .doc(userRes.data[0]._id)
        .update({
          data: {
            'stats.totalLikes': _.inc(newLikeStatus ? 1 : -1)
          }
        })
    }

    return { success: true, isLiked: newLikeStatus }

  } catch (error) {
    console.error('Toggle like error:', error)
    return { success: false, error: error.message }
  }
}
```

### 4.6 å¤´åƒä¸Šä¼ 

#### 4.6.1 å‰ç«¯å®ç°

```typescript
// src/services/user.ts
export const uploadAvatar = async (): Promise<string | null> => {
  try {
    // é€‰æ‹©å›¾ç‰‡
    const chooseRes = await Taro.chooseImage({
      count: 1,
      sizeType: ['compressed'],
      sourceType: ['album', 'camera']
    })

    const tempFilePath = chooseRes.tempFilePaths[0]
    const user = getUserInfo()

    if (!user) return null

    Taro.showLoading({ title: 'ä¸Šä¼ ä¸­...' })

    // ä¸Šä¼ åˆ°äº‘å­˜å‚¨
    const cloudPath = `avatars/${user.uid}_${Date.now()}.png`
    const uploadRes = await Taro.cloud.uploadFile({
      cloudPath: cloudPath,
      filePath: tempFilePath
    })

    // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
    const updateRes = await Taro.cloud.callFunction({
      name: 'updateUserProfile',
      data: {
        avatar: uploadRes.fileID
      }
    })

    Taro.hideLoading()

    if (updateRes.result.success) {
      // æ›´æ–°æœ¬åœ°å­˜å‚¨
      user.avatar = uploadRes.fileID
      Taro.setStorageSync('user', user)

      Taro.showToast({ title: 'ä¸Šä¼ æˆåŠŸ', icon: 'success' })
      return uploadRes.fileID
    } else {
      Taro.showToast({ title: 'ä¸Šä¼ å¤±è´¥', icon: 'none' })
      return null
    }

  } catch (error) {
    Taro.hideLoading()
    console.error('Upload avatar error:', error)
    Taro.showToast({ title: 'ä¸Šä¼ å¤±è´¥', icon: 'none' })
    return null
  }
}
```

---

## äº”ã€é¡µé¢ç»“æ„è®¾è®¡

### 5.1 é¡µé¢è·¯ç”±é…ç½®

```typescript
// src/app.config.ts
export default {
  pages: [
    'pages/index/index',              // é¦–é¡µ
    'pages/search/index',             // æœç´¢é¡µ
    'pages/anime-detail/index',       // åŠ¨æ¼«è¯¦æƒ…é¡µ
    'pages/my-collection/index',      // æˆ‘çš„æ”¶è—
    'pages/profile/index',            // ä¸ªäººä¸­å¿ƒ
    'pages/login/index'               // ç™»å½•é¡µ
  ],
  window: {
    backgroundTextStyle: 'light',
    navigationBarBackgroundColor: '#42BD56',  // è±†ç“£ç»¿
    navigationBarTitleTextStyle: 'white',
    navigationBarTextStyle: 'white'
  },
  tabBar: {
    color: '#999',
    selectedColor: '#42BD56',
    backgroundColor: '#fff',
    list: [
      {
        pagePath: 'pages/index/index',
        text: 'é¦–é¡µ',
        iconPath: 'assets/icons/home.png',
        selectedIconPath: 'assets/icons/home-active.png'
      },
      {
        pagePath: 'pages/my-collection/index',
        text: 'æ”¶è—',
        iconPath: 'assets/icons/collection.png',
        selectedIconPath: 'assets/icons/collection-active.png'
      },
      {
        pagePath: 'pages/profile/index',
        text: 'æˆ‘çš„',
        iconPath: 'assets/icons/profile.png',
        selectedIconPath: 'assets/icons/profile-active.png'
      }
    ]
  }
}
```

### 5.2 é¦–é¡µè®¾è®¡

**é¡µé¢å…ƒç´ ï¼š**
- æœç´¢æ¡†ï¼ˆå›ºå®šé¡¶éƒ¨ï¼‰
- æ¨èåŠ¨æ¼«åˆ—è¡¨ï¼ˆçƒ­é—¨/æœ€æ–°ï¼‰
- åŠ¨æ¼«å¡ç‰‡ï¼ˆæ¨ªå‘å¸ƒå±€ï¼‰

**UIç¤ºä¾‹ï¼š**
```jsx
// src/pages/index/index.tsx
import { View, Input } from '@tarojs/components'
import { AtSearchBar, AtCard, AtButton } from 'taro-ui'
import AnimeCard from '../../components/AnimeCard'

const Index = () => {
  const [keyword, setKeyword] = useState('')
  const [hotAnime, setHotAnime] = useState([])

  const handleSearch = () => {
    Taro.navigateTo({
      url: `/pages/search/index?keyword=${keyword}`
    })
  }

  return (
    <View className="index-page">
      <AtSearchBar
        value={keyword}
        onChange={setKeyword}
        onActionClick={handleSearch}
        placeholder="æœç´¢åŠ¨æ¼«..."
      />

      <View className="section">
        <View className="section-title">çƒ­é—¨åŠ¨æ¼«</View>
        {hotAnime.map(anime => (
          <AnimeCard key={anime.id} anime={anime} />
        ))}
      </View>
    </View>
  )
}
```

### 5.3 åŠ¨æ¼«è¯¦æƒ…é¡µè®¾è®¡

**é¡µé¢å…ƒç´ ï¼š**
- å°é¢å›¾ï¼ˆå¤§å›¾ï¼‰
- æ ‡é¢˜ï¼ˆä¸­æ–‡/æ—¥æ–‡ï¼‰
- è¯„åˆ†
- ç®€ä»‹
- å­£/é›†ä¿¡æ¯
- æ“ä½œæŒ‰é’®ï¼šæƒ³çœ‹/åœ¨çœ‹/çœ‹è¿‡ã€å–œæ¬¢

**è¿›åº¦é€‰æ‹©å™¨ï¼š**
```jsx
// src/components/EpisodeSelector/index.tsx
import { Picker } from '@tarojs/components'
import { AtButton } from 'taro-ui'

const EpisodeSelector = ({ totalSeasons, onUpdate }) => {
  const [season, setSeason] = useState(1)
  const [episode, setEpisode] = useState(1)

  return (
    <View className="episode-selector">
      <Picker
        mode="selector"
        range={Array.from({ length: totalSeasons }, (_, i) => `ç¬¬${i+1}å­£`)}
        onChange={e => setSeason(e.detail.value + 1)}
      >
        <AtButton>ç¬¬{season}å­£</AtButton>
      </Picker>

      <Picker
        mode="selector"
        range={Array.from({ length: 50 }, (_, i) => `ç¬¬${i+1}é›†`)}
        onChange={e => setEpisode(e.detail.value + 1)}
      >
        <AtButton>ç¬¬{episode}é›†</AtButton>
      </Picker>

      <AtButton
        type="primary"
        onClick={() => onUpdate(season, episode)}
      >
        æ›´æ–°è¿›åº¦
      </AtButton>
    </View>
  )
}
```

### 5.4 æˆ‘çš„æ”¶è—é¡µè®¾è®¡

**Tabåˆ‡æ¢ï¼š**
- åœ¨çœ‹
- çœ‹è¿‡
- æƒ³çœ‹

```jsx
// src/pages/my-collection/index.tsx
import { AtTabs, AtTabsPane } from 'taro-ui'

const MyCollection = () => {
  const [current, setCurrent] = useState(0)
  const tabs = [
    { title: 'åœ¨çœ‹' },
    { title: 'çœ‹è¿‡' },
    { title: 'æƒ³çœ‹' }
  ]

  return (
    <View>
      <AtTabs current={current} tabList={tabs} onClick={setCurrent}>
        <AtTabsPane current={current} index={0}>
          {/* åœ¨çœ‹åˆ—è¡¨ */}
        </AtTabsPane>
        <AtTabsPane current={current} index={1}>
          {/* çœ‹è¿‡åˆ—è¡¨ */}
        </AtTabsPane>
        <AtTabsPane current={current} index={2}>
          {/* æƒ³çœ‹åˆ—è¡¨ */}
        </AtTabsPane>
      </AtTabs>
    </View>
  )
}
```

### 5.5 ä¸ªäººä¸­å¿ƒé¡µè®¾è®¡

**é¡µé¢å…ƒç´ ï¼š**
- ç”¨æˆ·å¤´åƒï¼ˆå¯ç‚¹å‡»ä¸Šä¼ ï¼‰
- æ˜µç§°
- UID
- ç»Ÿè®¡ä¿¡æ¯ï¼ˆæ”¶è—æ•°ã€åœ¨çœ‹æ•°ã€çœ‹è¿‡æ•°ã€å–œæ¬¢æ•°ï¼‰
- è®¾ç½®é¡¹
  - ç»‘å®šæ‰‹æœºå·
  - é€€å‡ºç™»å½•

---

## å…­ã€è±†ç“£é£æ ¼æ ·å¼å®ç°

### 6.1 å…¨å±€æ ·å¼

```scss
// src/app.scss
$primary-color: #42BD56;    // è±†ç“£ç»¿
$orange-color: #F99600;     // è¯„åˆ†æ©™
$text-primary: #111;        // ä¸»æ–‡å­—
$text-secondary: #666;      // æ¬¡è¦æ–‡å­—
$text-light: #999;          // æµ…è‰²æ–‡å­—
$bg-color: #F5F5F5;         // èƒŒæ™¯è‰²
$border-color: #E5E5E5;     // è¾¹æ¡†è‰²

* {
  box-sizing: border-box;
}

page {
  background-color: $bg-color;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC',
               'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
}

.container {
  padding: 20px;
}
```

### 6.2 åŠ¨æ¼«å¡ç‰‡æ ·å¼

```scss
// src/components/AnimeCard/index.scss
.anime-card {
  display: flex;
  background: #fff;
  border-radius: 8px;
  padding: 16px;
  margin-bottom: 12px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);

  .cover {
    width: 100px;
    height: 140px;
    border-radius: 4px;
    overflow: hidden;
    flex-shrink: 0;
    margin-right: 16px;

    image {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
  }

  .content {
    flex: 1;
    display: flex;
    flex-direction: column;

    .title {
      font-size: 16px;
      font-weight: 600;
      color: $text-primary;
      margin-bottom: 4px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .subtitle {
      font-size: 13px;
      color: $text-secondary;
      margin-bottom: 8px;
    }

    .rating {
      display: flex;
      align-items: center;
      margin-bottom: 8px;

      .score {
        font-size: 18px;
        font-weight: bold;
        color: $orange-color;
        margin-right: 8px;
      }

      .stars {
        color: $orange-color;
      }
    }

    .tags {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 12px;

      .tag {
        padding: 2px 8px;
        background: #F0F0F0;
        border-radius: 4px;
        font-size: 12px;
        color: $text-secondary;
      }
    }

    .actions {
      margin-top: auto;
      display: flex;
      gap: 8px;

      .btn {
        flex: 1;
        height: 32px;
        line-height: 32px;
        border-radius: 4px;
        font-size: 13px;

        &.primary {
          background: $primary-color;
          color: #fff;
        }

        &.secondary {
          border: 1px solid $primary-color;
          color: $primary-color;
          background: #fff;
        }
      }
    }
  }
}
```

---

## ä¸ƒã€å¼€å‘è®¡åˆ’

### 7.1 ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ¡†æ¶ï¼ˆ1å‘¨ï¼‰

**ç›®æ ‡ï¼š** æ­å»ºé¡¹ç›®æ¡†æ¶ï¼Œå®ŒæˆåŸºæœ¬é…ç½®

- [ ] åˆå§‹åŒ–Taroé¡¹ç›®
- [ ] é…ç½®TypeScript
- [ ] é›†æˆTaro UI
- [ ] åˆ›å»ºé¡µé¢ç»“æ„
- [ ] é…ç½®å¾®ä¿¡äº‘å¼€å‘ç¯å¢ƒ
- [ ] åˆå§‹åŒ–æ•°æ®åº“é›†åˆ
- [ ] åˆ›å»ºåŸºç¡€äº‘å‡½æ•°

### 7.2 ç¬¬äºŒé˜¶æ®µï¼šæ ¸å¿ƒåŠŸèƒ½ï¼ˆ1.5å‘¨ï¼‰

**ç›®æ ‡ï¼š** å®ç°æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½

**Week 1:**
- [ ] ç”¨æˆ·ç™»å½•/æ³¨å†Œï¼ˆäº‘å‡½æ•° + å‰ç«¯ï¼‰
- [ ] UIDç”Ÿæˆé€»è¾‘
- [ ] åŠ¨æ¼«æœç´¢åŠŸèƒ½ï¼ˆBangumi APIé›†æˆï¼‰
- [ ] æœç´¢ç»“æœé¡µé¢
- [ ] åŠ¨æ¼«è¯¦æƒ…é¡µ

**Week 2:**
- [ ] æ”¶è—ç³»ç»Ÿï¼ˆæƒ³çœ‹/åœ¨çœ‹/çœ‹è¿‡ï¼‰
- [ ] è§‚çœ‹è¿›åº¦è®°å½•
- [ ] å–œæ¬¢åŠŸèƒ½
- [ ] æˆ‘çš„æ”¶è—é¡µï¼ˆTabåˆ‡æ¢ï¼‰
- [ ] ä¸ªäººä¸­å¿ƒé¡µ

### 7.3 ç¬¬ä¸‰é˜¶æ®µï¼šä¼˜åŒ–å®Œå–„ï¼ˆ0.5å‘¨ï¼‰

**ç›®æ ‡ï¼š** UIä¼˜åŒ–ã€æ€§èƒ½ä¼˜åŒ–ã€æµ‹è¯•

- [ ] è±†ç“£é£æ ¼ç•Œé¢è°ƒæ•´
- [ ] å¤´åƒä¸Šä¼ åŠŸèƒ½
- [ ] æ‰‹æœºå·ç»‘å®šï¼ˆå¯é€‰ï¼‰
- [ ] åŠ è½½çŠ¶æ€ä¼˜åŒ–
- [ ] é”™è¯¯å¤„ç†
- [ ] æ•°æ®ç¼“å­˜ä¼˜åŒ–
- [ ] å…¨é¢æµ‹è¯•

### 7.4 ç¬¬å››é˜¶æ®µï¼šä¸Šçº¿å‡†å¤‡ï¼ˆ0.5å‘¨ï¼‰

- [ ] æ€§èƒ½æµ‹è¯•
- [ ] çœŸæœºè°ƒè¯•
- [ ] æäº¤å®¡æ ¸
- [ ] å‘å¸ƒä¸Šçº¿

**é¢„è®¡æ€»å¼€å‘æ—¶é—´ï¼š** 3-4å‘¨

---

## å…«ã€éƒ¨ç½²æ–¹æ¡ˆ

### 8.1 å¾®ä¿¡äº‘å¼€å‘éƒ¨ç½²æ­¥éª¤

#### 8.1.1 å‰æœŸå‡†å¤‡

1. **æ³¨å†Œå¾®ä¿¡å°ç¨‹åº**
   - è®¿é—® https://mp.weixin.qq.com/
   - æ³¨å†Œå°ç¨‹åºè´¦å·
   - å®Œæˆè®¤è¯ï¼ˆå¯é€‰ï¼Œä¸ªäººç‰ˆå³å¯å¼€å‘ï¼‰

2. **å¼€é€šäº‘å¼€å‘**
   - åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­æ‰“å¼€é¡¹ç›®
   - ç‚¹å‡»"äº‘å¼€å‘"æŒ‰é’®
   - åˆ›å»ºäº‘å¼€å‘ç¯å¢ƒï¼ˆé€‰æ‹©æŒ‰é‡ä»˜è´¹æˆ–åŒ…å¹´åŒ…æœˆï¼‰
   - è®°å½•ç¯å¢ƒID

#### 8.1.2 é…ç½®äº‘å¼€å‘ç¯å¢ƒ

```javascript
// src/app.tsx
import Taro from '@tarojs/taro'

Taro.cloud.init({
  env: 'your-env-id',  // äº‘å¼€å‘ç¯å¢ƒID
  traceUser: true
})
```

#### 8.1.3 éƒ¨ç½²äº‘å‡½æ•°

```bash
# åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­
# å³é”®äº‘å‡½æ•°æ–‡ä»¶å¤¹ â†’ ä¸Šä¼ å¹¶éƒ¨ç½²ï¼šäº‘ç«¯å®‰è£…ä¾èµ–
```

æˆ–ä½¿ç”¨å‘½ä»¤è¡Œï¼š

```bash
# å®‰è£…äº‘å¼€å‘CLI
npm install -g @cloudbase/cli

# ç™»å½•
tcb login

# éƒ¨ç½²æ‰€æœ‰äº‘å‡½æ•°
tcb functions:deploy
```

#### 8.1.4 åˆå§‹åŒ–æ•°æ®åº“

```javascript
// åœ¨äº‘å¼€å‘æ§åˆ¶å° â†’ æ•°æ®åº“ â†’ åˆ›å»ºé›†åˆ

é›†åˆåˆ—è¡¨ï¼š
- users
- anime_cache
- collections
- watch_history
- counters

// è®¾ç½®ç´¢å¼•ï¼ˆåœ¨æ§åˆ¶å°æ“ä½œï¼‰
```

#### 8.1.5 é…ç½®æ•°æ®åº“æƒé™

```json
// åœ¨äº‘å¼€å‘æ§åˆ¶å° â†’ æ•°æ®åº“ â†’ æƒé™è®¾ç½®

// users é›†åˆ
{
  "read": "auth",
  "write": "auth"
}

// collections é›†åˆ
{
  "read": "auth",
  "write": "auth"
}

// anime_cache é›†åˆ
{
  "read": true,
  "write": false  // åªå…è®¸äº‘å‡½æ•°å†™
}
```

### 8.2 å‰ç«¯éƒ¨ç½²

```bash
# å¼€å‘ç¯å¢ƒ
npm run dev:weapp

# ç”Ÿäº§æ„å»º
npm run build:weapp

# åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­
# ç‚¹å‡»"ä¸Šä¼ " â†’ å¡«å†™ç‰ˆæœ¬å·å’Œå¤‡æ³¨ â†’ ä¸Šä¼ ä»£ç 
```

### 8.3 æäº¤å®¡æ ¸

1. ç™»å½•å°ç¨‹åºç®¡ç†åå°
2. ç‰ˆæœ¬ç®¡ç† â†’ å¼€å‘ç‰ˆæœ¬ â†’ æäº¤å®¡æ ¸
3. å¡«å†™å®¡æ ¸ä¿¡æ¯
4. ç­‰å¾…å®¡æ ¸ï¼ˆé€šå¸¸1-7å¤©ï¼‰
5. å®¡æ ¸é€šè¿‡åå‘å¸ƒ

### 8.4 ç›‘æ§ä¸ç»´æŠ¤

**äº‘å¼€å‘æ§åˆ¶å°ç›‘æ§ï¼š**
- äº‘å‡½æ•°è°ƒç”¨é‡
- æ•°æ®åº“è¯»å†™æ¬¡æ•°
- å­˜å‚¨ä½¿ç”¨é‡
- æµé‡ä½¿ç”¨æƒ…å†µ

**è®¾ç½®ç”¨é‡å‘Šè­¦ï¼š**
```
äº‘å¼€å‘æ§åˆ¶å° â†’ è®¾ç½® â†’ ç”¨é‡å‘Šè­¦
è®¾ç½®é˜ˆå€¼ï¼Œè¶…å‡ºæ—¶é‚®ä»¶/çŸ­ä¿¡é€šçŸ¥
```

---

## ä¹ã€æˆæœ¬ä¼°ç®—

### 9.1 äº‘å¼€å‘å…è´¹é¢åº¦

| èµ„æº | å…è´¹é¢åº¦/æœˆ | é¢„è®¡æ”¯æ’‘ç”¨æˆ·æ•° |
|------|------------|--------------|
| äº‘å‡½æ•°è°ƒç”¨ | 40ä¸‡æ¬¡ | ~2000äºº |
| äº‘æ•°æ®åº“ | 2GB | ~5000äºº |
| äº‘å­˜å‚¨ | 5GB | ~1000å¼ å¤´åƒ |
| CDNæµé‡ | 5GB | ~5000äºº |

### 9.2 è¶…å‡ºåè´¹ç”¨

- äº‘å‡½æ•°ï¼š0.0133å…ƒ/ä¸‡æ¬¡
- æ•°æ®åº“è¯»ï¼š0.015å…ƒ/ä¸‡æ¬¡
- æ•°æ®åº“å†™ï¼š0.05å…ƒ/ä¸‡æ¬¡
- å­˜å‚¨ï¼š0.004å…ƒ/GB/å¤©

**é¢„è®¡æœˆæˆæœ¬ï¼ˆ1000æ´»è·ƒç”¨æˆ·ï¼‰ï¼š** 0-50å…ƒ

---

## åã€åç»­è¿­ä»£è§„åˆ’

### 10.1 ç¬¬äºŒç‰ˆåŠŸèƒ½ï¼ˆv2.0ï¼‰

- [ ] åŠ¨æ¼«æ¨èç®—æ³•ï¼ˆåŸºäºæ”¶è—å†å²ï¼‰
- [ ] ç”¨æˆ·è¯„è®ºä¸è®¨è®º
- [ ] å¥½å‹ç³»ç»Ÿï¼ŒæŸ¥çœ‹å¥½å‹åœ¨çœ‹ä»€ä¹ˆ
- [ ] æ¯æ—¥æ‰“å¡ç­¾åˆ°
- [ ] åŠ¨æ¼«æ¦œå•ï¼ˆçƒ­é—¨æ¦œã€æ–°ç•ªæ¦œï¼‰
- [ ] åˆ†äº«åˆ°æœ‹å‹åœˆåŠŸèƒ½

### 10.2 ç¬¬ä¸‰ç‰ˆåŠŸèƒ½ï¼ˆv3.0ï¼‰

- [ ] AIæ™ºèƒ½æ¨è
- [ ] è§‚çœ‹ç»Ÿè®¡æŠ¥å‘Š
- [ ] å‹‹ç« æˆå°±ç³»ç»Ÿ
- [ ] å¤šå¹³å°æ”¯æŒï¼ˆH5ç‰ˆæœ¬ï¼‰
- [ ] æ•°æ®å¯¼å‡ºï¼ˆå¯¼å‡ºè§‚çœ‹è®°å½•ï¼‰

---

## åä¸€ã€å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### Q1: Bangumi APIè¯·æ±‚å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**æ–¹æ¡ˆï¼š**
1. å¢åŠ é‡è¯•æœºåˆ¶ï¼ˆæœ€å¤š3æ¬¡ï¼‰
2. ä½¿ç”¨æœ¬åœ°ç¼“å­˜æ•°æ®
3. æ¥å…¥å¤‡ç”¨æ•°æ®æºï¼ˆAniListï¼‰

### Q2: äº‘å¼€å‘å…è´¹é¢åº¦ç”¨å®Œäº†ï¼Ÿ

**æ–¹æ¡ˆï¼š**
1. ä¼˜åŒ–äº‘å‡½æ•°è°ƒç”¨ï¼ˆå‡å°‘ä¸å¿…è¦çš„è°ƒç”¨ï¼‰
2. å¢åŠ æœ¬åœ°ç¼“å­˜æ—¶é•¿
3. å‡çº§åˆ°ä»˜è´¹å¥—é¤ï¼ˆæˆæœ¬è¾ƒä½ï¼‰

### Q3: ä¸ªäººå°ç¨‹åºæ— æ³•è·å–æ‰‹æœºå·ï¼Ÿ

**æ–¹æ¡ˆï¼š**
1. ä½¿ç”¨çŸ­ä¿¡éªŒè¯ç æ–¹å¼
2. æ‰‹æœºå·ç»‘å®šè®¾ä¸ºå¯é€‰åŠŸèƒ½
3. å‡çº§ä¸ºä¼ä¸šå°ç¨‹åº

### Q4: å¦‚ä½•å¤„ç†å¤§é‡å¹¶å‘è¯·æ±‚ï¼Ÿ

**æ–¹æ¡ˆï¼š**
1. äº‘å‡½æ•°æ”¯æŒè‡ªåŠ¨æ‰©å®¹
2. æ•°æ®åº“æ·»åŠ åˆé€‚çš„ç´¢å¼•
3. ä½¿ç”¨Redisç¼“å­˜ï¼ˆäº‘å¼€å‘æš‚ä¸æ”¯æŒï¼Œå¯ç”¨æ•°æ®åº“ç¼“å­˜ä»£æ›¿ï¼‰

---

## åäºŒã€æ€»ç»“

æœ¬å®æ–½æ–¹æ¡ˆåŸºäº **Taro + å¾®ä¿¡äº‘å¼€å‘** æŠ€æœ¯æ ˆï¼Œå……åˆ†åˆ©ç”¨Serverlessæ¶æ„çš„ä¼˜åŠ¿ï¼Œå®ç°å¿«é€Ÿå¼€å‘ã€ä½æˆæœ¬è¿ç»´ã€‚é€šè¿‡é›†æˆ **Bangumi API** æä¾›ä¸°å¯Œçš„åŠ¨æ¼«æ•°æ®ï¼Œå‚è€ƒ **è±†ç“£è®¾è®¡é£æ ¼** æ‰“é€ ç¾è§‚æ˜“ç”¨çš„ç•Œé¢ã€‚

**æ ¸å¿ƒä¼˜åŠ¿ï¼š**
- å¼€å‘å‘¨æœŸçŸ­ï¼ˆ3-4å‘¨ï¼‰
- è¿è¥æˆæœ¬ä½ï¼ˆåˆæœŸå‡ ä¹å…è´¹ï¼‰
- æŠ€æœ¯æ ˆç»Ÿä¸€ï¼ˆå…¨æ ˆJavaScriptï¼‰
- æ˜“äºç»´æŠ¤å’Œè¿­ä»£

**å…³é”®æˆåŠŸå› ç´ ï¼š**
1. åˆç†çš„ç¼“å­˜ç­–ç•¥ï¼ˆå‡å°‘APIè°ƒç”¨ï¼‰
2. è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒï¼ˆæµç•…çš„äº¤äº’ï¼‰
3. ç¨³å®šçš„æ•°æ®æºï¼ˆBangumi APIï¼‰
4. æŒç»­çš„åŠŸèƒ½è¿­ä»£ï¼ˆæ ¹æ®ç”¨æˆ·åé¦ˆï¼‰

é¢„ç¥é¡¹ç›®å¼€å‘é¡ºåˆ©ï¼ ğŸ‰

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0
**æœ€åæ›´æ–°ï¼š** 2025å¹´11æœˆ17æ—¥
